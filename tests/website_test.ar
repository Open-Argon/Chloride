# SPDX-FileCopyrightText: 2025 William Bell
#
# SPDX-License-Identifier: GPL-3.0-or-later

import "../stdlib/network" expose tcp
import "../stdlib/random" expose random

let server = tcp(3000)

let i = 0

while (true) do
  let connection = server.accept()
  i=i+1
  term.log(i)

  let html = "<html><body><h1>requests: "+string(i)+"</h1><h2>requests: "+string(random.random())+"</h2></body></html>"

  let data = "HTTP/1.1 200 OK\r\nContent-Type: text/html; charset=utf-8\r\nContent-Length: "+string(html.length)+"\r\nConnection: close\r\n\r\n"+html+"\r\n"

  connection.send_string(data)
  connection.close()

server.close()