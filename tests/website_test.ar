import "../stdlib/network" expose tcp

let server = tcp(3000)

let i = 0

while (true) do
  let connection = server.accept()
  i=i+1
  term.log(i)

  let html = "<html><body><h1>requests: "+string(i)+"</h1></body></html>"

  let data = "HTTP/1.1 200 OK\nContent-Type: text/html; charset=utf-8\nContent-Length: "+string(html.length)+"\nConnection: close\n\n"+html+"\n"

  connection.send_string(data)
  connection.close()

server.close()