# SPDX-FileCopyrightText: 2025 William Bell
#
# SPDX-License-Identifier: GPL-3.0-or-later

import "../stdlib/raylib" expose raylib

class Based do
  this.abs(x)=do
    if (x<0) return -x
    return x

class Game(Based) do
  this.__init__(self, width, height, fps) = do
    self.frame = 0
    self.width = width
    self.height = height
    self.speedX = 1
    self.speedY = self.speedX
    raylib.InitWindow(self.width, self.height, "Hello Raylib")
    if (fps) raylib.SetTargetFPS(fps)

  this.render(self) = do
      # term.log("frame:",self.frame)
      let maxX = self.width -235, maxY = self.height-20
      raylib.ClearBackground(raylib.BLACK)

      let x = maxX - super.abs(((self.frame * self.speedX) % (2 * maxX)) - maxX)
      let y = maxY - super.abs(((self.frame * self.speedY) % (2 * maxY)) - maxY)
      
      raylib.DrawText("Hello world from Argon", x, y, 20, raylib.WHITE)

      self.frame=self.frame+1
  
  this.__string__(self) = do
    return "game instance"


let instance = Game(820, 640, 180)

instance.speedX=1

while (!raylib.WindowShouldClose()) do
  raylib.BeginDrawing()
  instance.render()
  raylib.EndDrawing()

raylib.CloseWindow()

term.log("bye :)")