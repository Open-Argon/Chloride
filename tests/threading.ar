# SPDX-FileCopyrightText: 2025 William Bell
#
# SPDX-License-Identifier: GPL-3.0-or-later

import "../stdlib/threading" as threading

let l = threading.Local()
term.log(threading.get_id())

let d() = do
  l.test = x
  let i = 0
  while (i<1e6) do
    i=i+1
  return i

let x = 0

let n = 16

while (x<10) do
  let threads = []
  let i = 0
  while (i<n) do
    threads.append(threading.Thread(d).start())
    i=i+1

  i = 0
  while (i<threads.length) do
    term.log(threads[i].join())
    i=i+1

  term.log("done", x)
  x=x+1


term.log(object.__getattribute__(l, "__maps__"))
term.log(threading.get_id())